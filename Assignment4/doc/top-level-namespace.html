<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>
  Top Level Namespace
  
    &mdash; Documentation by YARD 0.9.25
  
</title>

  <link rel="stylesheet" href="css/style.css" type="text/css" />

  <link rel="stylesheet" href="css/common.css" type="text/css" />

<script type="text/javascript">
  pathId = "";
  relpath = '';
</script>


  <script type="text/javascript" charset="utf-8" src="js/jquery.js"></script>

  <script type="text/javascript" charset="utf-8" src="js/app.js"></script>


  </head>
  <body>
    <div class="nav_wrap">
      <iframe id="nav" src="class_list.html?1"></iframe>
      <div id="resizer"></div>
    </div>

    <div id="main" tabindex="-1">
      <div id="header">
        <div id="menu">
  
    <a href="_index.html">Index</a> &raquo;
    
    
    <span class="title">Top Level Namespace</span>
  
</div>

        <div id="search">
  
    <a class="full_list_link" id="class_list_link"
        href="class_list.html">

        <svg width="24" height="24">
          <rect x="0" y="4" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="12" width="24" height="4" rx="1" ry="1"></rect>
          <rect x="0" y="20" width="24" height="4" rx="1" ry="1"></rect>
        </svg>
    </a>
  
</div>
        <div class="clear"></div>
      </div>

      <div id="content"><h1>Top Level Namespace
  
  
  
</h1>
<div class="box_info">
  

  
  
  
  
  

  

  
</div>








  
    <h2>
      Instance Method Summary
      <small><a href="#" class="summary_toggle">collapse</a></small>
    </h2>

    <ul class="summary">
      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#blast_db_against_db-instance_method" title="#blast_db_against_db (instance method)">#<strong>blast_db_against_db</strong>(db1_hash, db2_hash, evalue = nil, filtering = nil, coverage = nil, reverse_hash = nil)  &#x21d2; Hash&lt;Symbol, Symbol&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Blasts every sequence of database 1 against the complete database 2, and
stores the best results.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#build_arguments_string-instance_method" title="#build_arguments_string (instance method)">#<strong>build_arguments_string</strong>(evalue = nil, filtering = nil)  &#x21d2; String<sup>?</sup> </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given the E-value and filtering arguments, builds a string that will be
passed to the blast.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#coverage_bigger_than_threshold%3F-instance_method" title="#coverage_bigger_than_threshold? (instance method)">#<strong>coverage_bigger_than_threshold?</strong>(query_start, query_end, query_length, threshold)  &#x21d2; True, False </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given the start and end positions of the query sequence in the alignment,
its full length, and a threshold, returns True if the query coverage is
higher or equal than the threshold.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#create_factory-instance_method" title="#create_factory (instance method)">#<strong>create_factory</strong>(blast_type, database, arguments = nil)  &#x21d2; Bio::Blast </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Creates an appropriate blast factory to perform a certain type of blast on
a database (with or without additional arguments).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#determine_blast_type-instance_method" title="#determine_blast_type (instance method)">#<strong>determine_blast_type</strong>(type_query_seq, type_db)  &#x21d2; String </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Given the types of the query sequence and the target database, returns the
type of blast that needs to be performed (blastn, blastp, blastx, tblastn).</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#get_best_reciprocal_hits-instance_method" title="#get_best_reciprocal_hits (instance method)">#<strong>get_best_reciprocal_hits</strong>(db1_hash, db2_hash, evalue = nil, filtering = nil, coverage = nil)  &#x21d2; Hash&lt;Symbol, Symbol&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Performs the best reciprocal hit analysis between the two databases created
previously, and returns the hash with the best reciprocal hits found.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#make_blast_db-instance_method" title="#make_blast_db (instance method)">#<strong>make_blast_db</strong>(fastafilename)  &#x21d2; Hash&lt;Symbol, String&gt; </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Makes a blast database from a fasta file.</p>
</div></span>
  
</li>

      
        <li class="public ">
  <span class="summary_signature">
    
      <a href="top-level-namespace.html#write_report-instance_method" title="#write_report (instance method)">#<strong>write_report</strong>(best_reciprocal_hits, output_name = &quot;BRH_report.tsv&quot;)  &#x21d2; Object </a>
    

    
  </span>
  
  
  
  
  
  
  

  
    <span class="summary_desc"><div class='inline'>
<p>Writes a report with the best reciprocal hits found in the analysis, in a
.tsv format.</p>
</div></span>
  
</li>

      
    </ul>
  



  <div id="instance_method_details" class="method_details_list">
    <h2>Instance Method Details</h2>

    
      <div class="method_details first">
  <h3 class="signature first" id="blast_db_against_db-instance_method">
  
    #<strong>blast_db_against_db</strong>(db1_hash, db2_hash, evalue = nil, filtering = nil, coverage = nil, reverse_hash = nil)  &#x21d2; <tt>Hash&lt;Symbol, Symbol&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Blasts every sequence of database 1 against the complete database 2, and
stores the best results. If reverse hash is passed, it only blasts those
sequences that are values of that hash.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>db1_hash</span>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hash containing information about the first database (name without
extension, name with extension and type of database)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>db2_hash</span>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hash containing information about the second database (name without
extension, name with extension and type of database)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>evalue</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The E-value threshold, as a string, which will be passed to the argument -e
of blast. Example: 1*10^-6 would be “1e-6”. If nil, blast default is used.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>filtering</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The filters, as a string, which will be passed to the argument -F of blast.
Double string quotes are needed sometimes, for example: for -F “m S”, we
need to pass &#39;“m S”&#39; so that the inner quotes get included in the
argument string. If nil, blast default is used.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>coverage</span>
      
      
        <span class='type'>(<tt>Float</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Query coverage threshold, hits with lower query coverage will be discarded.
If nil, it won&#39;t filter by coverage.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>reverse_hash</span>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, Symbol&gt;</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The hash of the reverse search (database 2 against database 1).</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>A hash where the key is the id of the query sequence from database 1, and
the value is the id of the best hit in database 2.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'assignment4_functions.rb', line 154</span>

<span class='kw'>def</span> <span class='id identifier rubyid_blast_db_against_db'>blast_db_against_db</span><span class='lparen'>(</span><span class='id identifier rubyid_db1_hash'>db1_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_db2_hash'>db2_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_evalue'>evalue</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_filtering'>filtering</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_reverse_hash'>reverse_hash</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>

    <span class='comment'># Getting the additional arguments to pass to Bio::Blast.local
</span>    <span class='id identifier rubyid_arguments'>arguments</span> <span class='op'>=</span> <span class='id identifier rubyid_build_arguments_string'><span class='object_link'><a href="#build_arguments_string-instance_method" title="#build_arguments_string (method)">build_arguments_string</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_evalue'>evalue</span> <span class='op'>=</span> <span class='id identifier rubyid_evalue'>evalue</span><span class='comma'>,</span> <span class='id identifier rubyid_filtering'>filtering</span> <span class='op'>=</span> <span class='id identifier rubyid_filtering'>filtering</span><span class='rparen'>)</span>
    <span class='comment'># get the blast type:
</span>    <span class='id identifier rubyid_blast_type'>blast_type</span> <span class='op'>=</span> <span class='id identifier rubyid_determine_blast_type'><span class='object_link'><a href="#determine_blast_type-instance_method" title="#determine_blast_type (method)">determine_blast_type</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_type_query_seq'>type_query_seq</span> <span class='op'>=</span> <span class='id identifier rubyid_db1_hash'>db1_hash</span><span class='lbracket'>[</span><span class='symbol'>:db_type</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_type_db'>type_db</span> <span class='op'>=</span> <span class='id identifier rubyid_db2_hash'>db2_hash</span><span class='lbracket'>[</span><span class='symbol'>:db_type</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='comment'># build the appropriate blast factory:
</span>    <span class='id identifier rubyid_factory'>factory</span> <span class='op'>=</span> <span class='id identifier rubyid_create_factory'><span class='object_link'><a href="#create_factory-instance_method" title="#create_factory (method)">create_factory</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_blast_type'>blast_type</span><span class='comma'>,</span> <span class='id identifier rubyid_db2_hash'>db2_hash</span><span class='lbracket'>[</span><span class='symbol'>:fasta_file_no_ext</span><span class='rbracket'>]</span><span class='comma'>,</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='rparen'>)</span>

    <span class='comment'># For each sequence (query) in db1:
</span>    <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Blasting each sequence from </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_db1_hash'>db1_hash</span><span class='lbracket'>[</span><span class='symbol'>:fasta_file_no_ext</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'> against the database </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_db2_hash'>db2_hash</span><span class='lbracket'>[</span><span class='symbol'>:fasta_file_no_ext</span><span class='rbracket'>]</span><span class='embexpr_end'>}</span><span class='tstring_content'>...</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_best_hits_q1_db2'>best_hits_q1_db2</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span> <span class='comment'># hash to store the results
</span>    <span class='id identifier rubyid_db1_ff'>db1_ff</span> <span class='op'>=</span> <span class='const'>Bio</span><span class='op'>::</span><span class='const'>FlatFile</span><span class='period'>.</span><span class='id identifier rubyid_auto'>auto</span><span class='lparen'>(</span><span class='id identifier rubyid_db1_hash'>db1_hash</span><span class='lbracket'>[</span><span class='symbol'>:fasta_file</span><span class='rbracket'>]</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_db1_ff'>db1_ff</span><span class='period'>.</span><span class='id identifier rubyid_each_entry'>each_entry</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_entry'>entry</span><span class='op'>|</span>

        <span class='kw'>if</span> <span class='id identifier rubyid_reverse_hash'>reverse_hash</span> <span class='comment'># if there is a hash of the reverse search
</span>            <span class='comment'># skip this entry if it isn&#39;t a best hit of the reverse search
</span>            <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_reverse_hash'>reverse_hash</span><span class='period'>.</span><span class='id identifier rubyid_value?'>value?</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_definition'>definition</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>|</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span><span class='rparen'>)</span>
        <span class='kw'>end</span>

        <span class='id identifier rubyid_report'>report</span> <span class='op'>=</span> <span class='id identifier rubyid_factory'>factory</span><span class='period'>.</span><span class='id identifier rubyid_query'>query</span><span class='lparen'>(</span><span class='id identifier rubyid_entry'>entry</span><span class='rparen'>)</span>
        <span class='kw'>next</span> <span class='kw'>if</span> <span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_hits'>hits</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='comment'># if no results, skip
</span>        <span class='id identifier rubyid_best_hit'>best_hit</span> <span class='op'>=</span> <span class='id identifier rubyid_report'>report</span><span class='period'>.</span><span class='id identifier rubyid_hits'>hits</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span>
        <span class='comment'># filtering by coverage
</span>        <span class='kw'>unless</span> <span class='id identifier rubyid_coverage'>coverage</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span>
            <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_coverage_bigger_than_threshold?'><span class='object_link'><a href="#coverage_bigger_than_threshold%3F-instance_method" title="#coverage_bigger_than_threshold? (method)">coverage_bigger_than_threshold?</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_query_start'>query_start</span> <span class='op'>=</span> <span class='id identifier rubyid_best_hit'>best_hit</span><span class='period'>.</span><span class='id identifier rubyid_query_start'>query_start</span><span class='comma'>,</span>
                                                        <span class='id identifier rubyid_query_end'>query_end</span> <span class='op'>=</span> <span class='id identifier rubyid_best_hit'>best_hit</span><span class='period'>.</span><span class='id identifier rubyid_query_end'>query_end</span><span class='comma'>,</span>
                                                        <span class='id identifier rubyid_query_length'>query_length</span> <span class='op'>=</span> <span class='id identifier rubyid_best_hit'>best_hit</span><span class='period'>.</span><span class='id identifier rubyid_query_len'>query_len</span><span class='comma'>,</span> 
                                                        <span class='id identifier rubyid_threshold'>threshold</span> <span class='op'>=</span> <span class='id identifier rubyid_coverage'>coverage</span><span class='rparen'>)</span> <span class='comment'># True if coverage &gt; 0.5, so the hit doesn&#39;t get skipped
</span>        <span class='kw'>end</span>
        <span class='comment'># If by now the entry hasn&#39;t been skipped, the best hit had more than 50% coverage
</span>        <span class='comment'># We do the search in the opposite direction
</span>        <span class='id identifier rubyid_seq1'>seq1</span> <span class='op'>=</span> <span class='id identifier rubyid_entry'>entry</span><span class='period'>.</span><span class='id identifier rubyid_definition'>definition</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>|</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span> <span class='comment'># &#39;AT5G03780.1 | Symbols: TRFL10 | TRF-like 10 | chr5:999266-1000947 REVERSE LENGTH=1263&#39; -&gt; :AT5G03780.1
</span>        <span class='id identifier rubyid_seq2'>seq2</span> <span class='op'>=</span> <span class='id identifier rubyid_best_hit'>best_hit</span><span class='period'>.</span><span class='id identifier rubyid_definition'>definition</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>|</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span><span class='period'>.</span><span class='id identifier rubyid_strip'>strip</span><span class='period'>.</span><span class='id identifier rubyid_to_sym'>to_sym</span>
        <span class='id identifier rubyid_best_hits_q1_db2'>best_hits_q1_db2</span><span class='lbracket'>[</span><span class='id identifier rubyid_seq1'>seq1</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_seq2'>seq2</span> <span class='comment'># adding this to the hash
</span>    <span class='kw'>end</span>
<span class='kw'>return</span> <span class='id identifier rubyid_best_hits_q1_db2'>best_hits_q1_db2</span> <span class='comment'># returns the hash with the hits of each entry of db1 against db2
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="build_arguments_string-instance_method">
  
    #<strong>build_arguments_string</strong>(evalue = nil, filtering = nil)  &#x21d2; <tt>String</tt><sup>?</sup> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given the E-value and filtering arguments, builds a string that will be
passed to the blast.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>evalue</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The E-value threshold, as a string, which will be passed to the argument -e
of blast. Example: 1*10^-6 would be “1e-6”. If nil, blast default is used.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>filtering</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The filters, as a string, which will be passed to the argument -F of blast.
Double string quotes are needed sometimes, for example: for -F “m S”, we
need to pass &#39;“m S”&#39; so that the inner quotes get included in the
argument string. If nil, blast default is used.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The string with the arguments, or nil if the string is empty.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


115
116
117
118
119
120
121</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'assignment4_functions.rb', line 115</span>

<span class='kw'>def</span> <span class='id identifier rubyid_build_arguments_string'>build_arguments_string</span><span class='lparen'>(</span><span class='id identifier rubyid_evalue'>evalue</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_filtering'>filtering</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_arguments'>arguments</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_end'>&quot;</span></span>
    <span class='id identifier rubyid_arguments'>arguments</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-e </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_evalue'>evalue</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_evalue'>evalue</span> <span class='comment'># if evalue is not nil, adding the E-value argument
</span>    <span class='id identifier rubyid_arguments'>arguments</span> <span class='op'>+=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>-F </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filtering'>filtering</span><span class='embexpr_end'>}</span><span class='tstring_content'> </span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_filtering'>filtering</span> <span class='comment'># if filtering is not nil, adding the filtering argument
</span>    <span class='kw'>return</span> <span class='id identifier rubyid_arguments'>arguments</span> <span class='kw'>unless</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
    <span class='kw'>return</span> <span class='kw'>nil</span> <span class='kw'>if</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="coverage_bigger_than_threshold?-instance_method">
  
    #<strong>coverage_bigger_than_threshold?</strong>(query_start, query_end, query_length, threshold)  &#x21d2; <tt>True</tt>, <tt>False</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given the start and end positions of the query sequence in the alignment,
its full length, and a threshold, returns True if the query coverage is
higher or equal than the threshold.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>query_start</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Start position of the query in the alignment</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>query_end</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>End position of the query in the alignment</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>query_length</span>
      
      
        <span class='type'>(<tt>Integer</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Full length of the query</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>threshold</span>
      
      
        <span class='type'>(<tt>Float</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>Coverage threshold</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>True</tt>, <tt>False</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>If the query coverage is &gt;= the threshold.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


102
103
104
105</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'assignment4_functions.rb', line 102</span>

<span class='kw'>def</span> <span class='id identifier rubyid_coverage_bigger_than_threshold?'>coverage_bigger_than_threshold?</span><span class='lparen'>(</span><span class='id identifier rubyid_query_start'>query_start</span><span class='comma'>,</span> <span class='id identifier rubyid_query_end'>query_end</span><span class='comma'>,</span> <span class='id identifier rubyid_query_length'>query_length</span><span class='comma'>,</span> <span class='id identifier rubyid_threshold'>threshold</span><span class='rparen'>)</span>
    <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='lparen'>(</span><span class='id identifier rubyid_query_end'>query_end</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span> <span class='op'>-</span> <span class='id identifier rubyid_query_start'>query_start</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span><span class='rparen'>)</span><span class='op'>/</span><span class='id identifier rubyid_query_length'>query_length</span><span class='period'>.</span><span class='id identifier rubyid_to_f'>to_f</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>&gt;=</span> <span class='id identifier rubyid_threshold'>threshold</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="create_factory-instance_method">
  
    #<strong>create_factory</strong>(blast_type, database, arguments = nil)  &#x21d2; <tt>Bio::Blast</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Creates an appropriate blast factory to perform a certain type of blast on
a database (with or without additional arguments).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>blast_type</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The type of blast (“blastn”, “blastp”, “blastx”, “tblastn”).</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>database</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The path of the database.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>arguments</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The arguments string to pass to Bio::Blast.local as additional arguments.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Bio::Blast</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The blast factory.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


132
133
134
135
136
137
138
139</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'assignment4_functions.rb', line 132</span>

<span class='kw'>def</span> <span class='id identifier rubyid_create_factory'>create_factory</span><span class='lparen'>(</span><span class='id identifier rubyid_blast_type'>blast_type</span><span class='comma'>,</span> <span class='id identifier rubyid_database'>database</span><span class='comma'>,</span> <span class='id identifier rubyid_arguments'>arguments</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>
    <span class='kw'>if</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_nil?'>nil?</span> <span class='op'>||</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='period'>.</span><span class='id identifier rubyid_empty?'>empty?</span> <span class='comment'># no arguments passed
</span>        <span class='id identifier rubyid_factory'>factory</span> <span class='op'>=</span> <span class='const'>Bio</span><span class='op'>::</span><span class='const'>Blast</span><span class='period'>.</span><span class='id identifier rubyid_local'>local</span><span class='lparen'>(</span><span class='id identifier rubyid_blast_type'>blast_type</span><span class='comma'>,</span> <span class='id identifier rubyid_database'>database</span><span class='rparen'>)</span>
    <span class='kw'>else</span> <span class='comment'># some arguments passed
</span>        <span class='id identifier rubyid_factory'>factory</span> <span class='op'>=</span> <span class='const'>Bio</span><span class='op'>::</span><span class='const'>Blast</span><span class='period'>.</span><span class='id identifier rubyid_local'>local</span><span class='lparen'>(</span><span class='id identifier rubyid_blast_type'>blast_type</span><span class='comma'>,</span> <span class='id identifier rubyid_database'>database</span><span class='comma'>,</span> <span class='id identifier rubyid_arguments'>arguments</span><span class='rparen'>)</span> <span class='comment'># additional arguments
</span>    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_factory'>factory</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="determine_blast_type-instance_method">
  
    #<strong>determine_blast_type</strong>(type_query_seq, type_db)  &#x21d2; <tt>String</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Given the types of the query sequence and the target database, returns the
type of blast that needs to be performed (blastn, blastp, blastx, tblastn).</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>type_query_seq</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The type of sequence in the query database, “prot” for proteins, “nucl” for
nucleotides.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>type_db</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The type of sequence in the target database, “prot” for proteins, “nucl”
for nucleotides.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The type of blast.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


82
83
84
85
86
87
88
89
90</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'assignment4_functions.rb', line 82</span>

<span class='kw'>def</span> <span class='id identifier rubyid_determine_blast_type'>determine_blast_type</span><span class='lparen'>(</span><span class='id identifier rubyid_type_query_seq'>type_query_seq</span><span class='comma'>,</span> <span class='id identifier rubyid_type_db'>type_db</span><span class='rparen'>)</span>
    <span class='comment'># For this assignment only the last two are necessary
</span>    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blastp</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_type_query_seq'>type_query_seq</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prot</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_type_db'>type_db</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prot</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># search protein databases using a protein query
</span>    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blastn</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_type_query_seq'>type_query_seq</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nucl</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_type_db'>type_db</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nucl</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># search nucleotide databases using a nucleotide query
</span>    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>blastx</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_type_query_seq'>type_query_seq</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nucl</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_type_db'>type_db</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prot</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># search protein databases using a translated nucleotide query
</span>    <span class='kw'>return</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>tblastn</span><span class='tstring_end'>&quot;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_type_query_seq'>type_query_seq</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>prot</span><span class='tstring_end'>&quot;</span></span> <span class='op'>&amp;&amp;</span> <span class='id identifier rubyid_type_db'>type_db</span> <span class='op'>==</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>nucl</span><span class='tstring_end'>&quot;</span></span> <span class='comment'># search translated nucleotide databases using a protein query
</span>    <span class='comment'># if none of the above, the abort gets executed
</span>    <span class='id identifier rubyid_abort'>abort</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>This program doesn&#39;t support the combination of query type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_type_query_seq'>type_query_seq</span><span class='embexpr_end'>}</span><span class='tstring_content'> and database type </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_type_db'>type_db</span><span class='embexpr_end'>}</span><span class='tstring_content'>, it only accepts &#39;nucl&#39; or &#39;prot&#39;</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="get_best_reciprocal_hits-instance_method">
  
    #<strong>get_best_reciprocal_hits</strong>(db1_hash, db2_hash, evalue = nil, filtering = nil, coverage = nil)  &#x21d2; <tt>Hash&lt;Symbol, Symbol&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Performs the best reciprocal hit analysis between the two databases created
previously, and returns the hash with the best reciprocal hits found.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>db1_hash</span>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hash containing information about the first database (name without
extension, name with extension and type of database)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>db2_hash</span>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hash containing information about the second database (name without
extension, name with extension and type of database)</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>evalue</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The E-value threshold, as a string, which will be passed to the argument -e
of blast. Example: 1*10^-6 would be “1e-6”. If nil, blast default is used.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>filtering</span>
      
      
        <span class='type'>(<tt>String</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The filters, as a string, which will be passed to the argument -F of blast.
Double string quotes are needed sometimes, for example: for -F “m S”, we
need to pass &#39;“m S”&#39; so that the inner quotes get included in the
argument string. If nil, blast default is used.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>coverage</span>
      
      
        <span class='type'>(<tt>Float</tt>, <tt>nil</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>nil</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>Query coverage threshold, hits with lower query coverage will be discarded.
If nil, it won&#39;t filter by coverage.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hash containing the best reciprocal hits found by the analysis.</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'assignment4_functions.rb', line 51</span>

<span class='kw'>def</span> <span class='id identifier rubyid_get_best_reciprocal_hits'>get_best_reciprocal_hits</span><span class='lparen'>(</span><span class='id identifier rubyid_db1_hash'>db1_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_db2_hash'>db2_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_evalue'>evalue</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_filtering'>filtering</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='comma'>,</span> <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='kw'>nil</span><span class='rparen'>)</span>

    <span class='comment'># Get the best hits from blasting every sequence of db1 against db2
</span>    <span class='id identifier rubyid_best_hits_q1_against_db2'>best_hits_q1_against_db2</span> <span class='op'>=</span> <span class='id identifier rubyid_blast_db_against_db'><span class='object_link'><a href="#blast_db_against_db-instance_method" title="#blast_db_against_db (method)">blast_db_against_db</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db1_hash'>db1_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_db2_hash'>db2_hash</span><span class='comma'>,</span> 
        <span class='id identifier rubyid_evalue'>evalue</span> <span class='op'>=</span> <span class='id identifier rubyid_evalue'>evalue</span><span class='comma'>,</span> <span class='id identifier rubyid_filtering'>filtering</span> <span class='op'>=</span> <span class='id identifier rubyid_filtering'>filtering</span><span class='comma'>,</span> <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='id identifier rubyid_coverage'>coverage</span><span class='rparen'>)</span>
    <span class='comment'># Get the best hits from blasting every sequence of db2 against db1, including the previous results to avoid doing unnecessary blasts
</span>    <span class='id identifier rubyid_best_hits_q2_against_db1'>best_hits_q2_against_db1</span> <span class='op'>=</span> <span class='id identifier rubyid_blast_db_against_db'><span class='object_link'><a href="#blast_db_against_db-instance_method" title="#blast_db_against_db (method)">blast_db_against_db</a></span></span><span class='lparen'>(</span><span class='id identifier rubyid_db2_hash'>db2_hash</span><span class='comma'>,</span> <span class='id identifier rubyid_db1_hash'>db1_hash</span><span class='comma'>,</span> 
        <span class='id identifier rubyid_evalue'>evalue</span> <span class='op'>=</span> <span class='id identifier rubyid_evalue'>evalue</span><span class='comma'>,</span> <span class='id identifier rubyid_filtering'>filtering</span> <span class='op'>=</span> <span class='id identifier rubyid_filtering'>filtering</span><span class='comma'>,</span> <span class='id identifier rubyid_coverage'>coverage</span> <span class='op'>=</span> <span class='id identifier rubyid_coverage'>coverage</span><span class='comma'>,</span> <span class='id identifier rubyid_reverse_hash'>reverse_hash</span> <span class='op'>=</span> <span class='id identifier rubyid_best_hits_q1_against_db2'>best_hits_q1_against_db2</span><span class='rparen'>)</span>

    <span class='comment'># Reciprocal hits:
</span>    <span class='id identifier rubyid_reciprocal_hits'>reciprocal_hits</span> <span class='op'>=</span> <span class='lbrace'>{</span><span class='rbrace'>}</span>
    <span class='comment'># start with the second hash because we know its values are keys in the first hash
</span>    <span class='id identifier rubyid_best_hits_q2_against_db1'>best_hits_q2_against_db1</span><span class='period'>.</span><span class='id identifier rubyid_keys'>keys</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_seq2'>seq2</span><span class='op'>|</span>
        <span class='comment'># getting the best hit from seq2
</span>        <span class='id identifier rubyid_seq1'>seq1</span> <span class='op'>=</span> <span class='id identifier rubyid_best_hits_q2_against_db1'>best_hits_q2_against_db1</span><span class='lbracket'>[</span><span class='id identifier rubyid_seq2'>seq2</span><span class='rbracket'>]</span>
        <span class='comment'># checking if the best hit&#39;s best hit is itself
</span>        <span class='kw'>next</span> <span class='kw'>unless</span> <span class='id identifier rubyid_seq2'>seq2</span> <span class='op'>==</span> <span class='id identifier rubyid_best_hits_q1_against_db2'>best_hits_q1_against_db2</span><span class='lbracket'>[</span><span class='id identifier rubyid_seq1'>seq1</span><span class='rbracket'>]</span> <span class='comment'># skipping if not
</span>        <span class='comment'># if we&#39;re here, success, we&#39;ve found a best reciprocal hit
</span>        <span class='id identifier rubyid_reciprocal_hits'>reciprocal_hits</span><span class='lbracket'>[</span><span class='id identifier rubyid_seq2'>seq2</span><span class='rbracket'>]</span> <span class='op'>=</span> <span class='id identifier rubyid_seq1'>seq1</span> <span class='comment'># storing the results on the hash
</span>    <span class='kw'>end</span>
    <span class='kw'>return</span> <span class='id identifier rubyid_reciprocal_hits'>reciprocal_hits</span> <span class='comment'># returning the hash
</span><span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="make_blast_db-instance_method">
  
    #<strong>make_blast_db</strong>(fastafilename)  &#x21d2; <tt>Hash&lt;Symbol, String&gt;</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Makes a blast database from a fasta file.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>fastafilename</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The name of the fasta file.</p>
</div>
      
    </li>
  
</ul>

<p class="tag_title">Returns:</p>
<ul class="return">
  
    <li>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, String&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hash containing information about the database (name without extension,
name with extension and type of database).</p>
</div>
      
    </li>
  
</ul>

</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'assignment4_functions.rb', line 10</span>

<span class='kw'>def</span> <span class='id identifier rubyid_make_blast_db'>make_blast_db</span><span class='lparen'>(</span><span class='id identifier rubyid_fastafilename'>fastafilename</span><span class='rparen'>)</span>
    <span class='kw'>begin</span>
        <span class='comment'># Finding out if it contains protein sequences or nucleotide sequences. It will only look at the first entry, so every entry should have the same type.
</span>        <span class='id identifier rubyid_fastaff'>fastaff</span> <span class='op'>=</span> <span class='const'>Bio</span><span class='op'>::</span><span class='const'>FlatFile</span><span class='period'>.</span><span class='id identifier rubyid_auto'>auto</span><span class='lparen'>(</span><span class='id identifier rubyid_fastafilename'>fastafilename</span><span class='rparen'>)</span>
        <span class='id identifier rubyid_seq_type'>seq_type</span> <span class='op'>=</span> <span class='id identifier rubyid_fastaff'>fastaff</span><span class='period'>.</span><span class='id identifier rubyid_next_entry'>next_entry</span><span class='period'>.</span><span class='id identifier rubyid_to_biosequence'>to_biosequence</span><span class='period'>.</span><span class='id identifier rubyid_guess'>guess</span> <span class='comment'># the type of the first entry, if nucleotide, guess returns Bio::Sequence::NA, and if protein, Bio::Sequence::AA
</span>        <span class='id identifier rubyid_database_type'>database_type</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>nucl</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_seq_type'>seq_type</span> <span class='op'>==</span> <span class='const'>Bio</span><span class='op'>::</span><span class='const'>Sequence</span><span class='op'>::</span><span class='const'>NA</span>
        <span class='id identifier rubyid_database_type'>database_type</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&#39;</span><span class='tstring_content'>prot</span><span class='tstring_end'>&#39;</span></span> <span class='kw'>if</span> <span class='id identifier rubyid_seq_type'>seq_type</span> <span class='op'>==</span> <span class='const'>Bio</span><span class='op'>::</span><span class='const'>Sequence</span><span class='op'>::</span><span class='const'>AA</span>
        <span class='id identifier rubyid_abort'>abort</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>Unknown type of database encountered by make_blast_db with the file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_fastafile'>fastafile</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span> <span class='kw'>unless</span> <span class='id identifier rubyid_seq_type'>seq_type</span> <span class='op'>==</span> <span class='const'>Bio</span><span class='op'>::</span><span class='const'>Sequence</span><span class='op'>::</span><span class='const'>NA</span> <span class='op'>||</span> <span class='id identifier rubyid_seq_type'>seq_type</span> <span class='op'>==</span> <span class='const'>Bio</span><span class='op'>::</span><span class='const'>Sequence</span><span class='op'>::</span><span class='const'>AA</span>
        <span class='comment'># Creating the database using the command makeblastdb, calling it from ruby
</span>        <span class='id identifier rubyid_filename_without_ext'>filename_without_ext</span> <span class='op'>=</span> <span class='id identifier rubyid_fastafilename'>fastafilename</span><span class='period'>.</span><span class='id identifier rubyid_split'>split</span><span class='lparen'>(</span><span class='tstring'><span class='regexp_beg'>/</span><span class='tstring_content'>\.(?!\/)</span><span class='regexp_end'>/</span></span><span class='rparen'>)</span><span class='period'>.</span><span class='id identifier rubyid_first'>first</span> <span class='comment'># only splits by . if it isn&#39;t followed by / (https://stackoverflow.com/questions/12839645/ruby-string-split-with-regex)
</span>        <span class='id identifier rubyid_command'>command</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>makeblastdb -in </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_fastafilename'>fastafilename</span><span class='embexpr_end'>}</span><span class='tstring_content'> -dbtype &#39;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_database_type'>database_type</span><span class='embexpr_end'>}</span><span class='tstring_content'>&#39; -out </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_filename_without_ext'>filename_without_ext</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>\nCommand: \n </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_command'>command</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='comment'># calling the command:
</span>        <span class='id identifier rubyid_system'>system</span><span class='lparen'>(</span><span class='id identifier rubyid_command'>command</span><span class='rparen'>)</span>
        <span class='kw'>return</span> <span class='lbrace'>{</span><span class='label'>fasta_file:</span> <span class='id identifier rubyid_fastafilename'>fastafilename</span><span class='comma'>,</span>
                <span class='label'>fasta_file_no_ext:</span> <span class='id identifier rubyid_filename_without_ext'>filename_without_ext</span><span class='comma'>,</span>
                <span class='label'>db_type:</span> <span class='id identifier rubyid_database_type'>database_type</span><span class='rbrace'>}</span>
             <span class='comment'># returns a hash with the database name (with and without extension) and the database type
</span>    <span class='kw'>rescue</span> <span class='const'>Errno</span><span class='op'>::</span><span class='const'>ENOENT</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span> <span class='comment'># handling the missing file exception
</span>        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR: Can&#39;t find the file </span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_fastafilename'>fastafilename</span><span class='embexpr_end'>}</span><span class='tstring_end'>&quot;</span></span>
        <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
        <span class='id identifier rubyid_abort'>abort</span>
    <span class='kw'>rescue</span> <span class='const'>Exception</span> <span class='op'>=&gt;</span> <span class='id identifier rubyid_e'>e</span> <span class='comment'># other possible exceptions
</span>        <span class='id identifier rubyid_puts'>puts</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>ERROR in make_blast_db</span><span class='tstring_end'>&quot;</span></span>
        <span class='gvar'>$stderr</span><span class='period'>.</span><span class='id identifier rubyid_puts'>puts</span> <span class='id identifier rubyid_e'>e</span><span class='period'>.</span><span class='id identifier rubyid_inspect'>inspect</span>
        <span class='id identifier rubyid_abort'>abort</span>
    <span class='kw'>end</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
      <div class="method_details ">
  <h3 class="signature " id="write_report-instance_method">
  
    #<strong>write_report</strong>(best_reciprocal_hits, output_name = &quot;BRH_report.tsv&quot;)  &#x21d2; <tt>Object</tt> 
  

  

  
</h3><div class="docstring">
  <div class="discussion">
    
<p>Writes a report with the best reciprocal hits found in the analysis, in a
.tsv format.</p>


  </div>
</div>
<div class="tags">
  <p class="tag_title">Parameters:</p>
<ul class="param">
  
    <li>
      
        <span class='name'>best_reciprocal_hits</span>
      
      
        <span class='type'>(<tt>Hash&lt;Symbol, Symbol&gt;</tt>)</span>
      
      
      
        &mdash;
        <div class='inline'>
<p>The hash containing the best reciprocal hits found by the analysis.</p>
</div>
      
    </li>
  
    <li>
      
        <span class='name'>output_name</span>
      
      
        <span class='type'>(<tt>String</tt>)</span>
      
      
        <em class="default">(defaults to: <tt>&quot;BRH_report.tsv&quot;</tt>)</em>
      
      
        &mdash;
        <div class='inline'>
<p>The name of the output file.</p>
</div>
      
    </li>
  
</ul>


</div><table class="source_code">
  <tr>
    <td>
      <pre class="lines">


199
200
201
202
203
204
205</pre>
    </td>
    <td>
      <pre class="code"><span class="info file"># File 'assignment4_functions.rb', line 199</span>

<span class='kw'>def</span> <span class='id identifier rubyid_write_report'>write_report</span><span class='lparen'>(</span><span class='id identifier rubyid_best_reciprocal_hits'>best_reciprocal_hits</span><span class='comma'>,</span> <span class='id identifier rubyid_output_name'>output_name</span> <span class='op'>=</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>BRH_report.tsv</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_f'>f</span> <span class='op'>=</span> <span class='const'>File</span><span class='period'>.</span><span class='id identifier rubyid_new'>new</span><span class='lparen'>(</span><span class='id identifier rubyid_output_name'>output_name</span><span class='comma'>,</span> <span class='tstring'><span class='tstring_beg'>&quot;</span><span class='tstring_content'>w</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='id identifier rubyid_best_reciprocal_hits'>best_reciprocal_hits</span><span class='period'>.</span><span class='id identifier rubyid_each'>each</span> <span class='kw'>do</span> <span class='op'>|</span><span class='id identifier rubyid_seq1'>seq1</span><span class='comma'>,</span> <span class='id identifier rubyid_seq2'>seq2</span><span class='op'>|</span>
        <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_write'>write</span><span class='lparen'>(</span><span class='tstring'><span class='tstring_beg'>&quot;</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_seq1'>seq1</span><span class='embexpr_end'>}</span><span class='tstring_content'>\t</span><span class='embexpr_beg'>#{</span><span class='id identifier rubyid_seq2'>seq2</span><span class='embexpr_end'>}</span><span class='tstring_content'>\n</span><span class='tstring_end'>&quot;</span></span><span class='rparen'>)</span>
    <span class='kw'>end</span>
    <span class='id identifier rubyid_f'>f</span><span class='period'>.</span><span class='id identifier rubyid_close'>close</span>
<span class='kw'>end</span></pre>
    </td>
  </tr>
</table>
</div>
    
  </div>

</div>

      <div id="footer">
  Generated on Wed Dec  1 11:00:29 2021 by
  <a href="http://yardoc.org" title="Yay! A Ruby Documentation Tool" target="_parent">yard</a>
  0.9.25 (ruby-2.5.1).
</div>

    </div>
  </body>
</html>